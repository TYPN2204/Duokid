<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>C·ª≠a h√†ng tim</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <script src="/grade-dropdown.js" defer></script>
</head>
<body>
<div class="layout">
    <header class="top-nav">
        <div class="logo">duokid</div>
        <nav>
            <a th:href="@{/dashboard}">üè† H·ªåC</a>
            <span class="menu-divider"></span>
            <div class="grade-dropdown">
                <span class="grade-dropdown-trigger">üìö L·ªõp h·ªçc</span>
                <div class="grade-dropdown-menu">
                    <a th:href="@{/grade/GRADE1}">L·ªõp 1</a>
                    <a th:href="@{/grade/GRADE2}">L·ªõp 2</a>
                    <a th:href="@{/grade/GRADE3}">L·ªõp 3</a>
                    <a th:href="@{/grade/GRADE4}">L·ªõp 4</a>
                    <a th:href="@{/grade/GRADE5}">L·ªõp 5</a>
                </div>
            </div>
            <span class="menu-divider"></span>
            <a th:href="@{/mywords}">üìù S·ªï tay</a>
            <a th:href="@{/vocabulary}">üìö T·ª´ v·ª±ng</a>
            <a th:href="@{/practice}">üîÑ √în t·∫≠p</a>
            <a th:href="@{/minigame}">üéÆ Mini game</a>
            <a th:href="@{/leaderboard}">üèÜ B·∫£ng x·∫øp h·∫°ng</a>
            <a th:href="@{/shop}" class="active">üõí C·ª≠a h√†ng</a>
            <a th:href="@{/chat}">üí¨ Chat</a>
            <a th:href="@{/profile}">üë§ H·ªì s∆°</a>
            <span class="menu-divider"></span>
            <a th:href="@{/logout}">üö™ ƒêƒÉng xu·∫•t</a>
        </nav>
    </header>
    <main class="main">
        <h1>C·ª≠a h√†ng tim</h1>
        <div class="stats-bar" style="max-width: 400px; margin-bottom: 20px;">
            <div class="stat-item">
                <span class="stat-icon">‚ö°</span>
                <span>XP: <b th:text="${user.xp}">0</b></span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">üíé</span>
                <span>Gems: <b th:text="${user.gems}">500</b></span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">‚ù§Ô∏è</span>
                <span>Tim: <b th:text="${user.hearts}">5</b></span>
            </div>
        </div>
        <p th:if="${reason == 'no-hearts'}">
            B·∫°n ƒë√£ h·∫øt tim n√™n kh√¥ng th·ªÉ l√†m b√†i ki·ªÉm tra. H√£y mua th√™m tim ƒë·ªÉ ti·∫øp t·ª•c h·ªçc nh√©!
        </p>
        <div class="panel">
            <h3>Mua tim b·∫±ng XP</h3>
            <p>M·ªói tim t·ªën <b th:text="${xpPerHeart}">10</b> XP.</p>
            <form method="post" th:action="@{/shop/buy-hearts}" class="shop-form">
                <input type="hidden" name="paymentType" value="XP">
                <label>S·ªë tim mu·ªën mua:
                    <input type="number" name="amount" min="1" value="1">
                </label>
                <button type="submit" class="btn-main big">Mua tim b·∫±ng XP</button>
            </form>
            <p class="error" th:if="${error}" th:text="${error}"></p>
            <p class="success" th:if="${success}" th:text="${success}"></p>
        </div>
        
        <div class="panel">
            <h3>Mua tim b·∫±ng Gems</h3>
            <p>M·ªói tim t·ªën <b>200</b> Gems.</p>
            <form method="post" th:action="@{/shop/buy-hearts}" class="shop-form">
                <input type="hidden" name="paymentType" value="GEMS">
                <label>S·ªë tim mu·ªën mua:
                    <input type="number" name="amount" min="1" value="1">
                </label>
                <button type="submit" class="btn-main big" style="background: #F59E0B; border-color: #F59E0B;">
                    Mua tim b·∫±ng Gems üíé
                </button>
            </form>
        </div>
        <div class="panel">
            <h3>L·ªãch s·ª≠ giao d·ªãch</h3>
            <p th:if="${#lists.isEmpty(history)}">Ch∆∞a c√≥ giao d·ªãch n√†o.</p>
            <table class="history-table" th:if="${!#lists.isEmpty(history)}">
                <thead>
                <tr>
                    <th>Th·ªùi gian</th>
                    <th>Lo·∫°i</th>
                    <th>Tim</th>
                    <th>XP</th>
                    <th>Ghi ch√∫</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="tx : ${history}">
                    <td th:text="${tx.time}">2025-11-17</td>
                    <td th:text="${tx.type}">BUY</td>
                    <td th:text="${tx.heartsChanged}">+1</td>
                    <td th:text="${tx.xpChanged}">-10</td>
                    <td th:text="${tx.note}">Mua tim</td>
                </tr>
                </tbody>
            </table>
        </div>
    </main>
</div>
</body>
</html>
