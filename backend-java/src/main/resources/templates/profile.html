<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Th√¥ng tin h·ªçc sinh - Kid Nani</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <script src="/grade-dropdown.js" defer></script>
</head>
<body>
<div class="layout">
    <header class="top-nav">
        <div class="logo">duokid</div>
        <nav>
            <a th:href="@{/dashboard}">üè† H·ªåC</a>
            <span class="menu-divider"></span>
            <div class="grade-dropdown">
                <span class="grade-dropdown-trigger">üìö L·ªõp h·ªçc</span>
                <div class="grade-dropdown-menu">
                    <a th:href="@{/grade/GRADE1}">L·ªõp 1</a>
                    <a th:href="@{/grade/GRADE2}">L·ªõp 2</a>
                    <a th:href="@{/grade/GRADE3}">L·ªõp 3</a>
                    <a th:href="@{/grade/GRADE4}">L·ªõp 4</a>
                    <a th:href="@{/grade/GRADE5}">L·ªõp 5</a>
                </div>
            </div>
            <span class="menu-divider"></span>
            <a th:href="@{/mywords}">üìù S·ªï tay</a>
            <a th:href="@{/vocabulary}">üìö T·ª´ v·ª±ng</a>
            <a th:href="@{/practice}">üîÑ √în t·∫≠p</a>
            <a th:href="@{/minigame}">üéÆ Mini game</a>
            <a th:href="@{/tests}">üìù B√†i ki·ªÉm tra</a>
            <a th:href="@{/leaderboard}">üèÜ B·∫£ng x·∫øp h·∫°ng</a>
            <a th:href="@{/shop}">üõí C·ª≠a h√†ng</a>
            <a th:href="@{/chat}">üí¨ Chat</a>
            <a th:href="@{/profile}" class="active">üë§ H·ªì s∆°</a>
            <span class="menu-divider"></span>
            <a th:href="@{/logout}">üö™ ƒêƒÉng xu·∫•t</a>
        </nav>
    </header>
    <main class="main">
        <div class="lesson-header">
            <h1>üë§ Th√¥ng tin h·ªçc sinh</h1>
        </div>

        <!-- Success/Error Messages -->
        <div th:if="${success}" class="success" style="margin: 20px 0; padding: 15px; background: #D1FAE5; color: #065F46; border-radius: 8px; border: 2px solid #10B981;">
            <strong>‚úì</strong> <span th:text="${success}"></span>
        </div>
        
        <div th:if="${error}" class="error" style="margin: 20px 0; padding: 15px; background: #FEE2E2; color: #991B1B; border-radius: 8px; border: 2px solid #EF4444;">
            <strong>‚úó</strong> <span th:text="${error}"></span>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 30px; margin-top: 30px;">
            <!-- Left Column: Avatar and Stats -->
            <div>
                <!-- Avatar Section -->
                <div class="panel" style="text-align: center; padding: 30px;">
                    <div style="margin-bottom: 20px;">
                        <img th:src="${user.avatar ?: '/avatar1.svg'}" 
                             alt="Avatar" 
                             style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid #E5E7EB; margin-bottom: 15px;">
                    </div>
                    <h3 style="margin-bottom: 10px;" th:text="${user.displayName}">T√™n h·ªçc sinh</h3>
                    <p style="color: #6B7280; margin-bottom: 20px;" th:text="${user.email}">email@example.com</p>
                    
                    <!-- Upload Avatar Form -->
                    <form method="post" th:action="@{/profile/upload-avatar}" enctype="multipart/form-data" style="margin-top: 20px;">
                        <label style="display: block; margin-bottom: 10px;">
                            <input type="file" 
                                   name="avatar" 
                                   accept="image/*" 
                                   required
                                   style="margin-bottom: 10px; padding: 8px; width: 100%; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 14px;">
                        </label>
                        <button type="submit" class="btn-main" style="width: 100%;">
                            üì∑ T·∫£i ·∫£nh ƒë·∫°i di·ªán
                        </button>
                        <p style="font-size: 12px; color: #9CA3AF; margin-top: 8px;">
                            Ch·∫•p nh·∫≠n: JPG, PNG, GIF (t·ªëi ƒëa 5MB)
                        </p>
                    </form>
                </div>

                <!-- Statistics Card -->
                <div class="panel" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">üìä Th·ªëng k√™</h3>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #F9FAFB; border-radius: 8px;">
                            <span style="font-size: 20px;">üî•</span>
                            <div style="flex: 1; margin-left: 12px;">
                                <div style="font-weight: 600;">Chu·ªói ng√†y</div>
                                <div style="color: #6B7280; font-size: 14px;" th:text="${user.streak} + ' ng√†y'">0 ng√†y</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #F9FAFB; border-radius: 8px;">
                            <span style="font-size: 20px;">‚ö°</span>
                            <div style="flex: 1; margin-left: 12px;">
                                <div style="font-weight: 600;">ƒêi·ªÉm XP</div>
                                <div style="color: #6B7280; font-size: 14px;" th:text="${user.xp}">0</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #F9FAFB; border-radius: 8px;">
                            <span style="font-size: 20px;">üíé</span>
                            <div style="flex: 1; margin-left: 12px;">
                                <div style="font-weight: 600;">Gems</div>
                                <div style="color: #6B7280; font-size: 14px;" th:text="${user.gems}">0</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #F9FAFB; border-radius: 8px;">
                            <span style="font-size: 20px;">‚ù§Ô∏è</span>
                            <div style="flex: 1; margin-left: 12px;">
                                <div style="font-weight: 600;">Tim</div>
                                <div style="color: #6B7280; font-size: 14px;" th:text="${user.hearts}">0</div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #F9FAFB; border-radius: 8px;">
                            <span style="font-size: 20px;">üìö</span>
                            <div style="flex: 1; margin-left: 12px;">
                                <div style="font-weight: 600;">B√†i h·ªçc ƒë√£ ho√†n th√†nh</div>
                                <div style="color: #6B7280; font-size: 14px;" th:text="${completedLessonsCount}">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Profile Information -->
            <div>
                <!-- Personal Information -->
                <div class="panel">
                    <h3 style="margin-bottom: 20px;">üìù Th√¥ng tin c√° nh√¢n</h3>
                    <form method="post" th:action="@{/profile/update-info}">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                                T√™n hi·ªÉn th·ªã *
                            </label>
                            <input type="text" 
                                   name="displayName" 
                                   th:value="${user.displayName}"
                                   required
                                   style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 16px;">
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                                Email
                            </label>
                            <input type="email" 
                                   th:value="${user.email}"
                                   disabled
                                   style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 16px; background: #F3F4F6; color: #6B7280;">
                            <p style="font-size: 12px; color: #9CA3AF; margin-top: 5px;">Email kh√¥ng th·ªÉ thay ƒë·ªïi</p>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">
                                L·ªõp h·ªçc
                            </label>
                            <select name="gradeLevel" 
                                    style="width: 100%; padding: 12px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 16px;">
                                <option value="GRADE1" th:selected="${user.gradeLevel == 'GRADE1'}">L·ªõp 1</option>
                                <option value="GRADE2" th:selected="${user.gradeLevel == 'GRADE2'}">L·ªõp 2</option>
                                <option value="GRADE3" th:selected="${user.gradeLevel == 'GRADE3'}">L·ªõp 3</option>
                                <option value="GRADE4" th:selected="${user.gradeLevel == 'GRADE4'}">L·ªõp 4</option>
                                <option value="GRADE5" th:selected="${user.gradeLevel == 'GRADE5'}">L·ªõp 5</option>
                            </select>
                        </div>

                        <button type="submit" class="btn-main big" style="width: 100%;">
                            üíæ L∆∞u th√¥ng tin
                        </button>
                    </form>
                </div>

                <!-- Study Progress -->
                <div class="panel" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">üìà Ti·∫øn ƒë·ªô h·ªçc t·∫≠p</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: 600;">B√†i h·ªçc ƒë√£ ho√†n th√†nh</span>
                                <span style="color: #059669; font-weight: 600;" th:text="${completedLessonsCount}">0</span>
                            </div>
                            <div style="background: #E5E7EB; border-radius: 8px; height: 8px; overflow: hidden;">
                                <div style="background: #10B981; height: 100%; width: 100%; border-radius: 8px; transition: width 0.3s;"></div>
                            </div>
                        </div>
                        <div style="padding: 15px; background: #F0FDF4; border-radius: 8px; border: 2px solid #10B981;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 24px;">üéØ</span>
                                <div>
                                    <div style="font-weight: 600; color: #059669;">M·ª•c ti√™u h√¥m nay</div>
                                    <div style="color: #6B7280; font-size: 14px; margin-top: 4px;">
                                        Ti·∫øp t·ª•c h·ªçc ƒë·ªÉ duy tr√¨ chu·ªói ng√†y h·ªçc t·∫≠p!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
</body>
</html>

