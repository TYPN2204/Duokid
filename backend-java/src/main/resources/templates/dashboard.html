<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Kid Nani</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <script src="/lesson-path.js" defer></script>
    <script src="/grade-dropdown.js" defer></script>
</head>
<body>
<div class="layout">
    <!-- TOP NAVIGATION BAR -->
    <header class="top-nav">
        <div class="logo">duokid</div>
        <nav>
            <a th:href="@{/dashboard}" class="active">ğŸ  Há»ŒC</a>
            <span class="menu-divider"></span>
            <div class="grade-dropdown">
                <span class="grade-dropdown-trigger">ğŸ“š Lá»›p há»c</span>
                <div class="grade-dropdown-menu">
                    <a th:href="@{/grade/GRADE1}">Lá»›p 1</a>
                    <a th:href="@{/grade/GRADE2}">Lá»›p 2</a>
                    <a th:href="@{/grade/GRADE3}">Lá»›p 3</a>
                    <a th:href="@{/grade/GRADE4}">Lá»›p 4</a>
                    <a th:href="@{/grade/GRADE5}">Lá»›p 5</a>
                </div>
            </div>
            <span class="menu-divider"></span>
            <a th:href="@{/mywords}">ğŸ“ Sá»• tay</a>
            <a th:href="@{/vocabulary}">ğŸ“š Tá»« vá»±ng</a>
            <a th:href="@{/practice}">ğŸ”„ Ã”n táº­p</a>
            <a th:href="@{/minigame}">ğŸ® Mini game</a>
            <a th:href="@{/tests}">ğŸ“ BÃ i kiá»ƒm tra</a>
            <a th:href="@{/leaderboard}">ğŸ† Báº£ng xáº¿p háº¡ng</a>
            <a th:href="@{/shop}">ğŸ›’ Cá»­a hÃ ng</a>
            <a th:href="@{/chat}">ğŸ’¬ Chat</a>
            <a th:href="@{/profile}">ğŸ‘¤ Há»“ sÆ¡</a>
            <a th:if="${isAdmin}" th:href="@{/admin}" style="background: #FEF3C7; color: #92400E;">
                ğŸ‘‘ Quáº£n trá»‹
            </a>
            <span class="menu-divider"></span>
            <a th:href="@{/logout}">ğŸšª ÄÄƒng xuáº¥t</a>
        </nav>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main">
        <!-- Lesson Path Header -->
        <div class="lesson-path-container">
            <div class="path-header">
                <div class="path-header-left">
                    <span class="path-arrow">â†</span>
                    <span class="path-title" th:text="${lessonPath.size() > 0 ? (lessonPath[0].partName ?: 'PHáº¦N 1, Cá»¬A 1') : 'PHáº¦N 1, Cá»¬A 1'}">PHáº¦N 1, Cá»¬A 1</span>
                </div>
                <button class="path-guide-btn">
                    <span>ğŸ“‹</span>
                    <span>HÆ¯á»šNG DáºªN</span>
                </button>
            </div>

            <!-- Lesson Path Visualization -->
            <div class="lesson-path">
                <div th:each="lesson, iterStat : ${lessonPath}" class="lesson-node">
                    <!-- Connector line (except first) -->
                    <div th:if="${iterStat.index > 0}" 
                         class="path-connector"
                         th:classappend="${progressMap.get(lessonPath[iterStat.index - 1].id)?.completed} ? 'completed'">
                    </div>
                    
                    <!-- Lesson circle -->
                    <a th:href="@{'/lessons/' + ${lesson.id}}"
                       th:if="${progressMap.get(lesson.id)?.unlocked != false}"
                       class="lesson-circle"
                       th:classappend="${progressMap.get(lesson.id)?.completed} ? 'completed' : 'active'"
                       th:attr="data-lesson-id=${lesson.id}">
                        <span th:if="${progressMap.get(lesson.id)?.completed}">âœ“</span>
                        <span th:if="${!progressMap.get(lesson.id)?.completed}">â­</span>
                    </a>
                    <div th:if="${progressMap.get(lesson.id)?.unlocked == false}"
                         class="lesson-circle locked"
                         th:attr="data-lesson-id=${lesson.id}">
                        ğŸ”’
                    </div>
                    
                    <!-- Lesson label -->
                    <div class="lesson-label" 
                         th:classappend="${progressMap.get(lesson.id)?.unlocked != false && !progressMap.get(lesson.id)?.completed} ? 'active'">
                        <span th:text="${lesson.title}">Lesson</span>
                    </div>
                </div>
                
                <!-- Test node (appears after completing N lessons) -->
                <div class="lesson-node" th:if="${availableTest != null}">
                    <div class="path-connector" th:classappend="${completedLessonsCount >= availableTest.afterLessons} ? 'completed'"></div>
                    <a th:href="@{'/test/' + ${availableTest.id}}"
                       th:if="${completedLessonsCount >= availableTest.afterLessons}"
                       class="lesson-circle test-circle"
                       title="BÃ i kiá»ƒm tra">
                        ğŸ“
                    </a>
                    <div th:if="${completedLessonsCount < availableTest.afterLessons}"
                         class="lesson-circle test-circle locked"
                         title="HoÃ n thÃ nh thÃªm bÃ i há»c Ä‘á»ƒ má»Ÿ khÃ³a">
                        ğŸ”’
                    </div>
                    <div class="lesson-label" th:classappend="${completedLessonsCount >= availableTest.afterLessons} ? 'active'">
                        <span th:text="${availableTest.title}">BÃ i kiá»ƒm tra</span>
                    </div>
                </div>
                
                <!-- Duo mascot -->
                <div class="duo-mascot">ğŸ¦‰</div>
            </div>
        </div>
    </main>

    <!-- RIGHT SIDEBAR -->
    <aside class="right-sidebar">
        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="lang-flag">ğŸ‡ºğŸ‡¸</div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ”¥</span>
                <span th:text="${user.streak}">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">ğŸ’</span>
                <span th:text="${user.gems}">500</span>
            </div>
            <div class="stat-item">
                <span class="stat-icon">â¤ï¸</span>
                <span th:text="${user.hearts}">5</span>
            </div>
        </div>

        <!-- Leaderboard Unlock Card -->
        <div class="right-card leaderboard-unlock" th:if="${completedLessonsCount < 10}">
            <h3>Má»Ÿ khÃ³a Báº£ng xáº¿p háº¡ng!</h3>
            <div class="lock-icon">ğŸ”’</div>
            <p>HoÃ n thÃ nh thÃªm <strong th:text="${10 - completedLessonsCount}">10</strong> bÃ i há»c Ä‘á»ƒ báº¯t Ä‘áº§u thi Ä‘ua</p>
        </div>

        <!-- Daily Quests -->
        <div class="right-card">
            <h3>Nhiá»‡m vá»¥ háº±ng ngÃ y</h3>
            <a href="#" class="view-all-link">XEM Táº¤T Cáº¢</a>
            
            <div class="daily-quest">
                <div class="quest-icon">âš¡</div>
                <div class="quest-content">
                    <div class="quest-title">Kiáº¿m <span th:text="${dailyQuestTarget}">10</span> XP</div>
                    <div class="quest-progress-bar">
                        <div class="quest-progress-fill" 
                             th:style="'width: ' + ${dailyQuestProgress} + '%'">
                        </div>
                    </div>
                </div>
                <div class="quest-reward">ğŸ</div>
            </div>
            
            <div class="daily-quest">
                <div class="quest-icon">ğŸ“š</div>
                <div class="quest-content">
                    <div class="quest-title">HoÃ n thÃ nh 1 bÃ i há»c</div>
                    <div class="quest-progress-bar">
                        <div class="quest-progress-fill" 
                             th:style="'width: ' + ${daily.lessonCompleted ? 100 : 0} + '%'">
                        </div>
                    </div>
                </div>
                <div class="quest-reward">ğŸ</div>
            </div>
            
            <div class="daily-quest">
                <div class="quest-icon">âœ…</div>
                <div class="quest-content">
                    <div class="quest-title">HoÃ n thÃ nh 1 mini test</div>
                    <div class="quest-progress-bar">
                        <div class="quest-progress-fill" 
                             th:style="'width: ' + ${daily.quizCompleted ? 100 : 0} + '%'">
                        </div>
                    </div>
                </div>
                <div class="quest-reward">ğŸ</div>
            </div>
        </div>

        <!-- Profile Card (if not logged in) -->
        <div class="right-card" th:if="${user == null}">
            <h3>Táº¡o há»“ sÆ¡ Ä‘á»ƒ lÆ°u tiáº¿n trÃ¬nh cá»§a báº¡n!</h3>
            <a th:href="@{/register}" class="btn-main" style="width: 100%; margin-top: 12px; display: block; text-align: center;">
                Táº O Há»’ SÆ 
            </a>
            <a th:href="@{/login}" class="btn-main" style="width: 100%; margin-top: 8px; display: block; text-align: center; background: #3B82F6; border-color: #3B82F6;">
                ÄÄ‚NG NHáº¬P
            </a>
        </div>
    </aside>
</div>

</body>
</html>
