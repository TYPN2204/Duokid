<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'Káº¿t quáº£: ' + ${test.title}">Káº¿t quáº£ bÃ i kiá»ƒm tra</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <script src="/grade-dropdown.js" defer></script>
</head>
<body>
<div class="layout">
    <header class="top-nav">
        <div class="logo">duokid</div>
        <nav>
            <a th:href="@{/dashboard}">ğŸ  Há»ŒC</a>
            <span class="menu-divider"></span>
            <div class="grade-dropdown">
                <span class="grade-dropdown-trigger">ğŸ“š Lá»›p há»c</span>
                <div class="grade-dropdown-menu">
                    <a th:href="@{/grade/GRADE1}">Lá»›p 1</a>
                    <a th:href="@{/grade/GRADE2}">Lá»›p 2</a>
                    <a th:href="@{/grade/GRADE3}">Lá»›p 3</a>
                    <a th:href="@{/grade/GRADE4}">Lá»›p 4</a>
                    <a th:href="@{/grade/GRADE5}">Lá»›p 5</a>
                </div>
            </div>
            <span class="menu-divider"></span>
            <a th:href="@{/mywords}">ğŸ“ Sá»• tay</a>
            <a th:href="@{/vocabulary}">ğŸ“š Tá»« vá»±ng</a>
            <a th:href="@{/practice}">ğŸ”„ Ã”n táº­p</a>
            <a th:href="@{/minigame}">ğŸ® Mini game</a>
            <a th:href="@{/leaderboard}">ğŸ† Báº£ng xáº¿p háº¡ng</a>
            <a th:href="@{/shop}">ğŸ›’ Cá»­a hÃ ng</a>
            <a th:href="@{/chat}">ğŸ’¬ Chat</a>
            <a th:href="@{/profile}">ğŸ‘¤ Há»“ sÆ¡</a>
            <span class="menu-divider"></span>
            <a th:href="@{/logout}">ğŸšª ÄÄƒng xuáº¥t</a>
        </nav>
    </header>
    <main class="main">
        <div class="lesson-header">
            <h1>ğŸ“Š Káº¿t quáº£ bÃ i kiá»ƒm tra</h1>
        </div>

        <div th:if="${message}" class="success" style="margin: 20px 0; padding: 15px; background: #D1FAE5; color: #065F46; border-radius: 8px; border: 2px solid #10B981;">
            <strong>âœ“</strong> <span th:text="${message}"></span>
        </div>

        <div th:if="${error}" class="error" style="margin: 20px 0; padding: 15px; background: #FEE2E2; color: #991B1B; border-radius: 8px; border: 2px solid #EF4444;">
            <strong>âœ—</strong> <span th:text="${error}"></span>
        </div>

        <div th:if="${outOfHearts}" class="error" style="margin: 20px 0; padding: 15px; background: #FEE2E2; color: #991B1B; border-radius: 8px; border: 2px solid #EF4444;">
            <strong>âš ï¸</strong> Báº¡n Ä‘Ã£ háº¿t tim! HÃ£y <a th:href="@{/shop}" style="color: #DC2626; font-weight: bold;">mua thÃªm tim</a> Ä‘á»ƒ tiáº¿p tá»¥c há»c nhÃ©!
        </div>

        <div class="panel" style="text-align: center; margin: 30px 0;">
            <div style="font-size: 72px; margin-bottom: 20px;" th:if="${testPassed}">ğŸ‰</div>
            <div style="font-size: 72px; margin-bottom: 20px;" th:if="${!testPassed}">ğŸ˜¢</div>
            
            <h2 th:if="${testPassed}" style="color: #059669; margin-bottom: 15px;">ChÃºc má»«ng! Báº¡n Ä‘Ã£ vÆ°á»£t qua!</h2>
            <h2 th:if="${!testPassed}" style="color: #DC2626; margin-bottom: 15px;">ChÆ°a Ä‘áº¡t Ä‘iá»ƒm yÃªu cáº§u</h2>
            
            <div style="font-size: 48px; font-weight: 900; color: #1F2937; margin: 20px 0;">
                <span th:text="${testScore}">0</span>/100
            </div>
            
            <p style="font-size: 18px; color: #6B7280; margin: 10px 0;">
                Sá»‘ cÃ¢u Ä‘Ãºng: <strong th:text="${testCorrect}">0</strong>/<span th:text="${testTotal}">10</span>
            </p>
        </div>

        <div class="panel" style="margin: 20px 0;">
            <h3>ğŸ“‹ Chi tiáº¿t cÃ¢u há»i</h3>
            <div th:each="q,iter : ${questions}" class="quiz-result-item" style="margin: 20px 0; padding: 15px; background: #F9FAFB; border-radius: 8px;">
                <h4 th:text="${iter.index + 1} + '. ' + ${q.question}">CÃ¢u há»i</h4>
                <div style="margin: 10px 0;">
                    <div th:class="${q.correctOption == 'A' ? 'correct-answer' : ''}" style="padding: 8px; margin: 5px 0;">
                        <strong>A.</strong> <span th:text="${q.optionA}"></span>
                    </div>
                    <div th:class="${q.correctOption == 'B' ? 'correct-answer' : ''}" style="padding: 8px; margin: 5px 0;">
                        <strong>B.</strong> <span th:text="${q.optionB}"></span>
                    </div>
                    <div th:class="${q.correctOption == 'C' ? 'correct-answer' : ''}" style="padding: 8px; margin: 5px 0;">
                        <strong>C.</strong> <span th:text="${q.optionC}"></span>
                    </div>
                    <div th:class="${q.correctOption == 'D' ? 'correct-answer' : ''}" style="padding: 8px; margin: 5px 0;">
                        <strong>D.</strong> <span th:text="${q.optionD}"></span>
                    </div>
                </div>
                <div th:if="${q.explanation}" style="margin-top: 10px; padding: 10px; background: #E0F2FE; border-radius: 6px; color: #0369A1;">
                    <strong>ğŸ’¡ Giáº£i thÃ­ch:</strong> <span th:text="${q.explanation}"></span>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <a th:href="@{/dashboard}" class="btn-main big">Vá» trang chÃ­nh</a>
        </div>
    </main>
</div>
<style>
.correct-answer {
    background: #D1FAE5 !important;
    border-left: 4px solid #059669;
    font-weight: 600;
    color: #065F46;
}
</style>
</body>
</html>

