<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ã”n táº­p hÃ´m nay</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <script src="/grade-dropdown.js" defer></script>
</head>
<body>
<div class="layout">
    <header class="top-nav">
        <div class="logo">duokid</div>
        <nav>
            <a th:href="@{/dashboard}">ğŸ  Há»ŒC</a>
            <span class="menu-divider"></span>
            <div class="grade-dropdown">
                <span class="grade-dropdown-trigger">ğŸ“š Lá»›p há»c</span>
                <div class="grade-dropdown-menu">
                    <a th:href="@{/grade/GRADE1}">Lá»›p 1</a>
                    <a th:href="@{/grade/GRADE2}">Lá»›p 2</a>
                    <a th:href="@{/grade/GRADE3}">Lá»›p 3</a>
                    <a th:href="@{/grade/GRADE4}">Lá»›p 4</a>
                    <a th:href="@{/grade/GRADE5}">Lá»›p 5</a>
                </div>
            </div>
            <span class="menu-divider"></span>
            <a th:href="@{/mywords}">ğŸ“ Sá»• tay</a>
            <a th:href="@{/vocabulary}">ğŸ“š Tá»« vá»±ng</a>
            <a th:href="@{/practice}">ğŸ”„ Ã”n táº­p</a>
            <a th:href="@{/minigame}">ğŸ® Mini game</a>
            <a th:href="@{/leaderboard}">ğŸ† Báº£ng xáº¿p háº¡ng</a>
            <a th:href="@{/shop}">ğŸ›’ Cá»­a hÃ ng</a>
            <a th:href="@{/chat}">ğŸ’¬ Chat</a>
            <a th:href="@{/profile}">ğŸ‘¤ Há»“ sÆ¡</a>
            <span class="menu-divider"></span>
            <a th:href="@{/logout}">ğŸšª ÄÄƒng xuáº¥t</a>
        </nav>
    </header>
    <main class="main">
        <h1>Ã”n táº­p hÃ´m nay</h1>
        <p>Há»c láº¡i má»™t pháº§n trong bÃ i:</p>
        <h2 th:text="${lesson.title}">TÃªn bÃ i</h2>
        <div th:utext="${lesson.contentHtml}"></div>
        
        <div style="display: flex; gap: 12px; margin: 20px 0; flex-wrap: wrap;">
            <form th:action="@{'/quiz/' + ${lesson.id}}" method="get" style="margin: 0;">
                <button type="submit" class="btn-main big">LÃ m mini test</button>
            </form>
            <form th:action="@{'/practice/game?lessonId=' + ${lesson.id}}" method="get" style="margin: 0;">
                <button type="submit" class="btn-main big" style="background: #10B981; border-color: #10B981;">
                    ğŸ® Luyá»‡n táº­p vá»›i game hÃ¬nh áº£nh
                </button>
            </form>
        </div>

        <div class="panel">
            <h3>ğŸ¤– AI cháº¥m Ä‘iá»ƒm cÃ¢u tráº£ lá»i</h3>
            <p><strong>Äá» bÃ i:</strong> <span th:text="${practiceQuestion}">Question</span></p>
            <p><strong>CÃ¢u máº«u:</strong> <span th:text="${practiceExpected}">Expected</span></p>
            <form th:action="@{/practice/grade}" method="post" class="ai-form">
                <input type="hidden" name="lessonId" th:value="${lesson.id}">
                <input type="hidden" name="question" th:value="${practiceQuestion}">
                <input type="hidden" name="expected" th:value="${practiceExpected}">
                <textarea name="studentAnswer"
                          rows="3"
                          placeholder="Nháº­p cÃ¢u tiáº¿ng Anh cá»§a em..."
                          th:text="${studentAnswer}"></textarea>
                <button type="submit" class="btn-main">Cháº¥m Ä‘iá»ƒm</button>
            </form>
            <p class="error" th:if="${gradeError}" th:text="${gradeError}"></p>
            <div class="panel" th:if="${gradeScore != null}">
                <p><strong>Äiá»ƒm:</strong> <span th:text="${gradeScore}">80</span>/100</p>
                <p><strong>Feedback (EN):</strong> <span th:text="${gradeCommentEn}"></span></p>
                <p><strong>Nháº­n xÃ©t (VI):</strong> <span th:text="${gradeCommentVi}"></span></p>
                <p><strong>CÃ¢u máº«u:</strong> <span th:text="${practiceExpected}"></span></p>
            </div>
        </div>
    </main>
</div>
</body>
</html>
