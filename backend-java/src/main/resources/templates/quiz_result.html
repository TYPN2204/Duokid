<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Káº¿t quáº£</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <script src="/grade-dropdown.js" defer></script>
</head>
<body>
<div class="layout">
    <header class="top-nav">
        <div class="logo">duokid</div>
        <nav>
            <a th:href="@{/dashboard}">ğŸ  Há»ŒC</a>
            <span class="menu-divider"></span>
            <div class="grade-dropdown">
                <span class="grade-dropdown-trigger">ğŸ“š Lá»›p há»c</span>
                <div class="grade-dropdown-menu">
                    <a th:href="@{/grade/GRADE1}">Lá»›p 1</a>
                    <a th:href="@{/grade/GRADE2}">Lá»›p 2</a>
                    <a th:href="@{/grade/GRADE3}">Lá»›p 3</a>
                    <a th:href="@{/grade/GRADE4}">Lá»›p 4</a>
                    <a th:href="@{/grade/GRADE5}">Lá»›p 5</a>
                </div>
            </div>
            <span class="menu-divider"></span>
            <a th:href="@{/mywords}">ğŸ“ Sá»• tay</a>
            <a th:href="@{/vocabulary}">ğŸ“š Tá»« vá»±ng</a>
            <a th:href="@{/practice}">ğŸ”„ Ã”n táº­p</a>
            <a th:href="@{/minigame}">ğŸ® Mini game</a>
            <a th:href="@{/leaderboard}">ğŸ† Báº£ng xáº¿p háº¡ng</a>
            <a th:href="@{/shop}">ğŸ›’ Cá»­a hÃ ng</a>
            <a th:href="@{/chat}">ğŸ’¬ Chat</a>
            <a th:href="@{/profile}">ğŸ‘¤ Há»“ sÆ¡</a>
            <span class="menu-divider"></span>
            <a th:href="@{/logout}">ğŸšª ÄÄƒng xuáº¥t</a>
        </nav>
    </header>
    <main class="main">
        <h1 th:text="'Káº¿t quáº£: ' + ${lesson.title}">Káº¿t quáº£</h1>
        <p>Báº¡n lÃ m Ä‘Ãºng <b th:text="${correct}">0</b> / <b th:text="${total}">0</b> cÃ¢u.</p>
        <p th:if="${wrong > 0}">
            Báº¡n tráº£ lá»i sai <b th:text="${wrong}">0</b> cÃ¢u â†’ Ä‘Ã£ bá»‹ trá»« cÃ¹ng sá»‘ tim tÆ°Æ¡ng á»©ng. â¤ï¸
        </p>
        <p>Tim cÃ²n láº¡i: <b th:text="${user.hearts}">0</b></p>
        
        <!-- Perfect score - vÆ°á»£t áº£i -->
        <div th:if="${perfect}" style="background: #D1FAE5; border: 2px solid #10B981; border-radius: 8px; padding: 20px; margin: 20px 0;">
            <h2 style="margin: 0 0 10px 0; color: #065F46;">ğŸ‰ ChÃºc má»«ng! Báº¡n Ä‘Ã£ vÆ°á»£t áº£i!</h2>
            <p style="margin: 0; color: #065F46;">
                âœ… Báº¡n Ä‘Ã£ tráº£ lá»i Ä‘Ãºng <strong>100%</strong> cÃ¡c cÃ¢u há»i!<br>
                ğŸ BÃ i há»c tiáº¿p theo Ä‘Ã£ Ä‘Æ°á»£c má»Ÿ khÃ³a!<br>
                âš¡ Báº¡n Ä‘Ã£ nháº­n Ä‘Æ°á»£c XP vÃ  gems!
            </p>
        </div>
        
        <!-- RÆ°Æ¡ng thÆ°á»Ÿng khi hoÃ n thÃ nh má»™t Ã´ cá»­a -->
        <div th:if="${gateReward != null and gateReward.gateCompleted}" 
             style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border: 3px solid #F59E0B; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);">
            <div style="text-align: center; margin-bottom: 15px;">
                <div style="font-size: 64px; margin-bottom: 10px;">ğŸ</div>
                <h2 style="margin: 0; color: #92400E; font-size: 24px;">RÆ¯Æ NG THÆ¯á»NG Ã” Cá»¬A <span th:text="${gateReward.gateNumber}">1</span>!</h2>
            </div>
            <div style="background: white; border-radius: 8px; padding: 15px; margin: 15px 0; text-align: center;">
                <p style="margin: 0; color: #92400E; font-size: 18px; font-weight: bold;">
                    ğŸ‰ Báº¡n Ä‘Ã£ hoÃ n thÃ nh háº¿t táº¥t cáº£ bÃ i há»c trong <strong>Ã” cá»­a <span th:text="${gateReward.gateNumber}">1</span></strong>!
                </p>
            </div>
            <div style="display: flex; justify-content: space-around; margin: 20px 0; flex-wrap: wrap; gap: 15px;">
                <div style="background: white; border-radius: 8px; padding: 15px; text-align: center; flex: 1; min-width: 120px;">
                    <div style="font-size: 32px; margin-bottom: 5px;">ğŸ’</div>
                    <div style="color: #92400E; font-size: 20px; font-weight: bold;" th:text="'+' + ${gateReward.gemsReward} + ' Gems'">+50 Gems</div>
                </div>
                <div style="background: white; border-radius: 8px; padding: 15px; text-align: center; flex: 1; min-width: 120px;">
                    <div style="font-size: 32px; margin-bottom: 5px;">âš¡</div>
                    <div style="color: #92400E; font-size: 20px; font-weight: bold;" th:text="'+' + ${gateReward.xpReward} + ' XP'">+100 XP</div>
                </div>
            </div>
            <div th:if="${gateReward.nextGateUnlocked}" 
                 style="background: #D1FAE5; border: 2px solid #10B981; border-radius: 8px; padding: 15px; margin-top: 15px; text-align: center;">
                <p style="margin: 0; color: #065F46; font-weight: bold;">
                    ğŸšª <strong>Ã” cá»­a <span th:text="${gateReward.nextGateNumber}">2</span></strong> Ä‘Ã£ Ä‘Æ°á»£c má»Ÿ khÃ³a! HÃ£y tiáº¿p tá»¥c há»c nhÃ©! ğŸ‰
                </p>
            </div>
        </div>
        
        <!-- Passed but not perfect -->
        <div th:if="${passed && !perfect}" style="background: #FEF3C7; border: 2px solid #F59E0B; border-radius: 8px; padding: 20px; margin: 20px 0;">
            <h3 style="margin: 0 0 10px 0; color: #92400E;">ğŸ‘ Tá»‘t láº¯m! Báº¡n Ä‘Ã£ Ä‘áº¡t 70%+</h3>
            <p style="margin: 0; color: #92400E;">
                âš¡ Báº¡n Ä‘Ã£ nháº­n Ä‘Æ°á»£c XP vÃ  cáº­p nháº­t streak.<br>
                âš ï¸ NhÆ°ng Ä‘á»ƒ <strong>vÆ°á»£t áº£i</strong>, báº¡n cáº§n tráº£ lá»i Ä‘Ãºng <strong>100%</strong> cÃ¡c cÃ¢u há»i.<br>
                ğŸ’ª HÃ£y há»c láº¡i vÃ  thá»­ láº¡i Ä‘á»ƒ vÆ°á»£t áº£i nhÃ©!
            </p>
        </div>
        
        <!-- Not passed -->
        <div th:if="${!passed}" style="background: #FEE2E2; border: 2px solid #EF4444; border-radius: 8px; padding: 20px; margin: 20px 0;">
            <h3 style="margin: 0 0 10px 0; color: #991B1B;">ğŸ˜¢ ChÆ°a Ä‘áº¡t yÃªu cáº§u</h3>
            <p style="margin: 0; color: #991B1B;">
                Báº¡n chÆ°a Ä‘áº¡t 70%. HÃ£y há»c láº¡i bÃ i vÃ  thá»­ láº¡i mini test nhÃ©.<br>
                ğŸ’¡ Äá»ƒ vÆ°á»£t áº£i, báº¡n cáº§n tráº£ lá»i Ä‘Ãºng <strong>100%</strong> cÃ¡c cÃ¢u há»i.
            </p>
        </div>
        
        <p th:if="${outOfHearts}" style="background: #FEE2E2; border: 2px solid #EF4444; border-radius: 8px; padding: 15px; color: #991B1B;">
            âš ï¸ Báº¡n Ä‘Ã£ háº¿t tim. HÃ£y vÃ o cá»­a hÃ ng Ä‘á»ƒ mua thÃªm tim nhÃ©.
        </p>
        
        <div style="display: flex; gap: 12px; margin: 20px 0; flex-wrap: wrap;">
            <!-- NÃºt thá»­ láº¡i náº¿u chÆ°a perfect vÃ  cÃ²n tim -->
            <a th:if="${!perfect && user.hearts > 0}" 
               th:href="@{'/quiz/' + ${lesson.id}}" 
               class="btn-main big" 
               style="background: #3B82F6; border-color: #3B82F6;">
                ğŸ”„ Thá»­ láº¡i Mini Test
            </a>
            
            <!-- NÃºt vá» dashboard náº¿u Ä‘Ã£ perfect -->
            <a th:if="${perfect}" 
               th:href="@{/dashboard}" 
               class="btn-main big" 
               style="background: #10B981; border-color: #10B981;">
                ğŸ‰ Tiáº¿p tá»¥c há»c
            </a>
            
            <a th:href="@{'/lessons/' + ${lesson.id}}" class="btn-main">ğŸ“š Xem láº¡i bÃ i há»c</a>
            <a th:href="@{/dashboard}" class="btn-main">ğŸ  Vá» trang chÃ­nh</a>
            <a th:if="${outOfHearts}" th:href="@{/shop}" class="btn-main" style="background: #EF4444; border-color: #EF4444;">
                â¤ï¸ Mua tim
            </a>
        </div>
    </main>
</div>
</body>
</html>
